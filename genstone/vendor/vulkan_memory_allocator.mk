_VULKAN_MEMORY_ALLOCATOR_COMMON_CFLAGS = -DVMA_STATIC_VULKAN_FUNCTIONS -DVMA_DEBUG_DONT_EXCEED_MAX_MEMORY_ALLOCATION_COUNT -Igenstone/vendor/VulkanMemoryAllocator/include

ifeq ($(BUILD_MODE),DEBUG)
_VULKAN_MEMORY_ALLOCATOR_COMMON_CFLAGS += -DVMA_RECORDING_ENABLED -DVMA_DEBUG_INITIALIZE_ALLOCATIONS
endif

_VULKAN_MEMORY_ALLOCATOR_CXXFLAGS = $(_VULKAN_MEMORY_ALLOCATOR_COMMON_CFLAGS) -DVMA_IMPLEMENTATION -DTARGET_OS_OSX=1 -DTARGET_OS_MACCATALYST=0 -Wno-nullability-completeness

VULKAN_MEMORY_ALLOCATOR_CFLAGS = $(_VULKAN_MEMORY_ALLOCATOR_COMMON_CFLAGS)
VULKAN_MEMORY_ALLOCATOR_LFLAGS = -lVMA

VULKAN_MEMORY_ALLOCATOR_SOURCES = $(wildcard genstone/vendor/VMA-Support/*.cpp)
VULKAN_MEMORY_ALLOCATOR_OBJECTS = $(VULKAN_MEMORY_ALLOCATOR_SOURCES:.cpp=$(OBJECT_SUFFIX))

VULKAN_MEMORY_ALLOCATOR_LIB = lib/$(LIB_PREFIX)VMA$(DYNAMIC_LIB_SUFFIX)

build_message_vulkan_memory_allocator:
	@$(ECHO) "$(SECTION_PREFIX) Vulkan Memory Allocator"
	@$(ECHO) "$(INFO_PREFIX) GPU-Open makes allocations on the funny grahpics machine"

vulkan_memory_allocator: build_message_vulkan_memory_allocator $(VULKAN_MEMORY_ALLOCATOR_LIB) ### @Vendor Builds Vulkan Memory Allocator as a Genstone module

$(VULKAN_MEMORY_ALLOCATOR_LIB): CXXFLAGS = $(_VULKAN_MEMORY_ALLOCATOR_CXXFLAGS)
$(VULKAN_MEMORY_ALLOCATOR_LIB): LFLAGS = -Llib $(VULKAN_LFLAGS)
$(VULKAN_MEMORY_ALLOCATOR_LIB): CLANG_FORMAT = DISABLED
$(VULKAN_MEMORY_ALLOCATOR_LIB): $(VULKAN_MEMORY_ALLOCATOR_OBJECTS) $(VULKAN_LIB) | lib

clean_vulkan_memory_allocator:
	@$(ECHO) "$(ACTION_PREFIX)"
	-rm $(VULKAN_MEMORY_ALLOCATOR_OBJECTS)
	-rm $(VULKAN_MEMORY_ALLOCATOR_LIB)
	@$(ECHO) "$(ACTION_SUFFIX)"

